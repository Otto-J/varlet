import{F as $e,u as pe}from"./provide-0e5b054b.js";import{H as Ne,u as ne}from"./index-a002b329.js";import{v as Ce}from"./index-9698d333.js";import{d as M,h as He,a as $,c as ze,w as De}from"./components-c1e1aae1.js";import{m as Le,f as Pe}from"./elements-4558e7ec.js";import{w as ae}from"./logger-525ef361.js";import{d as Te,r as W,W as we,B as y,a4 as o,a2 as m,U as I,ab as A,F as le,ar as Ee,b1 as Me,ah as Oe,n as Ue,_ as Be,b as oe,K as We,e as X,l as Y,m as g,t as d,v as p,M as Ie,N as Ae,L as Xe,s as Ye,O as Re,p as se,Q as Ke}from"./index-e8376e61.js";var l=(e=>(e.First="1",e.Second="2",e))(l||{});const Qe={modelValue:{type:[Number,Array],default:0},step:{type:[Number,String],default:1},range:Boolean,labelVisible:{type:String,default:"normal"},activeColor:String,trackColor:String,thumbColor:String,labelColor:String,labelTextColor:String,trackHeight:[String,Number],max:{type:[String,Number],default:100},min:{type:[String,Number],default:0},thumbSize:[String,Number],disabled:Boolean,readonly:Boolean,direction:{type:String,default:"horizontal"},rules:Array,onChange:M(),onStart:M(),onEnd:M(),"onUpdate:modelValue":M()},{n:ie,classes:je}=ze("slider"),qe=Te({name:"VarSlider",components:{VarFormDetails:$e,VarHoverOverlay:Ne},directives:{Hover:Ce},props:Qe,setup(e){const{bindForm:z,form:b}=pe(),{errorMessage:R,validateWithTrigger:K,validate:Q,resetValidation:D}=He(),{hovering:L,handleHovering:P}=ne(),{hovering:i,handleHovering:N}=ne(),ue=()=>Q(e.rules,e.modelValue),j=()=>({startPosition:0,currentOffset:0,active:!1,percentValue:0}),ce=()=>Ue(()=>K(["onChange"],"onChange",e.rules,e.modelValue)),O=W(null),h=W(0),T=W(!1),a=we({[l.First]:j(),[l.Second]:j()}),U=y(()=>o(e.max)-o(e.min)),V=y(()=>h.value/U.value*o(e.step)),de=y(()=>{const{modelValue:t,range:r}=e;let n=[];return r&&m(t)?n=[{value:k(t[0]),enumValue:l.First,text:C(t[0]),hovering:I(L),handleHovering:P},{value:k(t[1]),enumValue:l.Second,text:C(t[1]),hovering:I(i),handleHovering:N}]:A(t)&&(n=[{value:k(t),enumValue:l.First,text:C(t),hovering:I(L),handleHovering:P}]),n}),ve=y(()=>{const{activeColor:t,range:r,modelValue:n}=e,s=r&&m(n)?k(Math.min(n[0],n[1])):0,u=r&&m(n)?k(Math.max(n[0],n[1]))-s:k(n);return S.value?{left:"0px",height:`${u}%`,bottom:`${s}%`,background:t}:{top:"0px",width:`${u}%`,left:`${s}%`,background:t}}),f=y(()=>e.disabled||(b==null?void 0:b.disabled.value)),w=y(()=>e.readonly||(b==null?void 0:b.readonly.value)),S=y(()=>e.direction==="vertical");let v;const me=t=>{const r=t.currentTarget;return r?S.value?h.value-(t.clientY-Oe(r).top):t.clientX-Pe(r):0},he=t=>({[S.value?"bottom":"left"]:`${t.value}%`,zIndex:a[t.enumValue].active?1:void 0}),fe=t=>e.labelVisible==="always"?!0:e.labelVisible==="never"?!1:a[t].active,k=t=>{const{min:r,max:n}=e;return t<o(r)?0:t>o(n)?100:(t-o(r))/U.value*100},C=t=>{if(!A(t))return 0;let r=t;return r<Number(e.min)&&(r=Number(e.min)),r>Number(e.max)&&(r=Number(e.max)),parseInt(`${r}`,10)===r?r:o(r.toPrecision(5))},ge=(t,r)=>{f.value||r.handleHovering(t)},q=(t,r)=>{let n=[];const{step:s,range:u,modelValue:c,onChange:H,min:x}=e,ee=o(s),te=Math.round(t/V.value),E=te*ee+o(x),ke=a[r].percentValue*ee+o(x);if(a[r].percentValue=te,u&&m(c)&&(n=r===l.First?[E,c[1]]:[c[0],E]),ke!==E){const re=u?n.map(Fe=>C(Fe)):C(E);$(H,re),$(e["onUpdate:modelValue"],re),ce()}},be=t=>{if(!e.range)return l.First;const r=a[l.First].percentValue*V.value,n=a[l.Second].percentValue*V.value,s=Math.abs(t-r),u=Math.abs(t-n);return s<=u?l.First:l.Second},Ve=()=>{document.addEventListener("touchmove",B,{passive:!1}),document.addEventListener("touchend",F),document.addEventListener("touchcancel",F)},G=()=>{document.removeEventListener("touchmove",B),document.removeEventListener("touchend",F),document.removeEventListener("touchcancel",F)},Se=(t,r)=>{if(h.value||(h.value=O.value.offsetWidth),f.value||(a[r].active=!0),v=r,Ve(),f.value||w.value)return;$(e.onStart),T.value=!0;const{clientX:n,clientY:s}=t.touches[0];a[r].startPosition=S.value?s:n},B=t=>{if(t.preventDefault(),f.value||w.value||!T.value)return;const{startPosition:r,currentOffset:n}=a[v],{clientX:s,clientY:u}=t.touches[0];let c=(S.value?r-u:s-r)+n;c<=0?c=0:c>=h.value&&(c=h.value),q(c,v)},F=()=>{G();const{range:t,modelValue:r,onEnd:n,step:s,min:u}=e;if(f.value||(a[v].active=!1),f.value||w.value)return;let c=[];a[v].currentOffset=a[v].percentValue*V.value;const H=a[v].percentValue*o(s)+o(u);t&&m(r)&&(c=v===l.First?[H,r[1]]:[r[0],H]),$(n,t?c:H),T.value=!1},ye=t=>{if(f.value||w.value||t.target.closest(`.${ie("thumb")}`))return;const r=me(t),n=be(r);v=n,q(r,n),F()},J=()=>{const t=o(e.step);return isNaN(t)?(ae("Slider",'type of prop "step" should be Number'),!1):t<0?(ae("Slider",'"step" should be > 0'),!1):!0},Z=()=>{const{range:t,modelValue:r}=e;return t&&!m(r)?(console.error('[Varlet] Slider: "modelValue" should be an Array'),!1):!t&&m(r)?(console.error('[Varlet] Slider: "modelValue" should be a Number'),!1):t&&m(r)&&r.length<2?(console.error('[Varlet] Slider: "modelValue" should have two value'),!1):!0},_=(t=e.modelValue,r=o(e.step))=>{const n=s=>{const{min:u,max:c}=e;return s<o(u)?0:s>o(c)?U.value/r:(s-o(u))/r};e.range&&m(t)?(a[l.First].percentValue=n(t[0]),a[l.First].currentOffset=a[l.First].percentValue*V.value,a[l.Second].percentValue=n(t[1]),a[l.Second].currentOffset=a[l.Second].percentValue*V.value):A(t)&&(a[l.First].currentOffset=n(t)*V.value)};return $(z,{reset:()=>{const t=e.range?[0,0]:0;$(e["onUpdate:modelValue"],t),D()},validate:ue,resetValidation:D}),le([()=>e.modelValue,()=>e.step],([t,r])=>{!J()||!Z()||T.value||_(t,o(r))}),le(h,()=>_()),Ee(()=>{!J()||!Z()||(h.value=O.value[S.value?"offsetHeight":"offsetWidth"])}),Me(()=>{G()}),{n:ie,classes:je,Thumbs:l,sliderEl:O,getFillStyle:ve,isDisabled:f,isVertical:S,thumbStyle:he,errorMessage:R,thumbsProps:a,thumbList:de,hover:ge,multiplySizeUnit:Le,toNumber:o,showLabel:fe,start:Se,move:B,end:F,click:ye}}});const Ge=["onTouchstart"];function Je(e,z,b,R,K,Q){const D=oe("var-hover-overlay"),L=oe("var-form-details"),P=We("hover");return X(),Y("div",{class:d(e.classes(e.n(e.direction),e.n("$--box")))},[g("div",{class:d(e.classes(e.n(`${e.direction}-block`),[e.isDisabled,e.n("--disabled")],[e.errorMessage,e.n(`${e.direction}--error`)])),ref:"sliderEl",onClick:z[0]||(z[0]=(...i)=>e.click&&e.click(...i))},[g("div",{class:d(e.n(`${e.direction}-track`))},[g("div",{class:d(e.n(`${e.direction}-track-background`)),style:p({background:e.trackColor,height:e.isVertical?"100%":e.multiplySizeUnit(e.trackHeight),width:e.isVertical?e.multiplySizeUnit(e.trackHeight):"100%"})},null,6),g("div",{class:d(e.n(`${e.direction}-track-fill`)),style:p(e.getFillStyle)},null,6)],2),(X(!0),Y(Ie,null,Ae(e.thumbList,i=>(X(),Y("div",{class:d(e.n(`${e.direction}-thumb`)),key:i.enumValue,style:p(e.thumbStyle(i)),onTouchstart:Xe(N=>e.start(N,i.enumValue),["stop"])},[Ye(e.$slots,"button",{currentValue:i.text},()=>[Re(g("div",{class:d(e.n(`${e.direction}-thumb-block`)),style:p({background:e.thumbColor})},null,6),[[P,N=>e.hover(N,i),"desktop"]]),g("div",{class:d(e.classes(e.n(`${e.direction}-thumb-ripple`),[e.thumbsProps[i.enumValue].active,e.n(`${e.direction}-thumb-ripple--active`)])),style:p({background:e.thumbsProps[i.enumValue].active?e.thumbColor:void 0})},[se(D,{hovering:i.hovering},null,8,["hovering"])],6),g("div",{class:d(e.classes(e.n(`${e.direction}-thumb-label`),[e.showLabel(i.enumValue),e.n(`${e.direction}-thumb-label--active`)])),style:p({background:e.labelColor,color:e.labelTextColor,height:e.thumbSize===void 0?e.thumbSize:e.multiplySizeUnit(e.thumbSize,2),width:e.thumbSize===void 0?e.thumbSize:e.multiplySizeUnit(e.thumbSize,2)})},[g("span",null,Ke(i.text),1)],6)])],46,Ge))),128))],2),se(L,{"error-message":e.errorMessage,class:d(e.n("form")),"var-slider-cover":""},null,8,["error-message","class"])],2)}const Ze=Be(qe,[["render",Je]]);De(Ze);export{Ze as S};
