import{p as we,S as ge}from"./index-34ccf6d5.js";import{S as Te}from"./index-818cb6af.js";import{I as Ce}from"./index-1bb8087a.js";import{p as Ie,P as Se}from"./index-3cef9030.js";import{d as Pe,r as d,b0 as Oe,B as W,a4 as b,a7 as ye,F as De,aB as q,_ as Re,b as k,e as S,f as A,w as N,p as ke,aq as Ne,l as H,M as $e,N as ze,t as h,m as B,v as Le,s as E,Q as G,q as Q,af as be,W as Ae,n as Be,ac as Ee,a2 as Ve}from"./index-bf3396a3.js";import{d as Z,p as j,c as Ye,a as P,m as Fe,w as x}from"./components-a440a044.js";const Me={show:Boolean,imagePreventDefault:Boolean,images:{type:Array,default:()=>[]},current:String,initialIndex:{type:[String,Number],default:0},zoom:{type:[String,Number],default:2},closeable:Boolean,"onUpdate:show":Z(),onLongPress:Z(),...j(we,["loop","indicator","onChange"]),...j(Ie,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{name:Ue,n:J,classes:Xe}=Ye("image-preview"),V=12,K=200,We=350,_=200,qe=500,He=Pe({name:Ue,components:{VarSwipe:ge,VarSwipeItem:Te,VarPopup:Se,VarIcon:Ce},inheritAttrs:!1,props:Me,setup(e){const i=d(!1),a=d(1),u=d(0),f=d(0),y=d(),T=d(),C=d(!0),w=d(null),{moveX:z,moveY:c,distance:m,startTime:r,startTouch:ee,moveTouch:ne,endTouch:Y}=Oe(),oe=W(()=>{const{images:n,current:o,initialIndex:t}=e;if(t!=null)return b(t);const l=n.findIndex(p=>p===o);return Math.max(l,0)}),te=W(()=>{const{imagePreventDefault:n,show:o}=e;return o&&n});let F=null,I=null,D=!1;const s={start:null,prev:null};ye(()=>document,"contextmenu",he),De(()=>e.show,n=>{i.value=n},{immediate:!0});function ae(){a.value=b(e.zoom),C.value=!1,s.prev=null,window.setTimeout(()=>{y.value="linear",T.value="0s"},_)}function M(){a.value=1,u.value=0,f.value=0,C.value=!0,s.prev=null,y.value=void 0,T.value=void 0}function se(n){return s.prev?m.value<=V&&performance.now()-r.value<=K&&s.prev===n:!1}function ie(n){return!n||!s.start||!s.prev?!1:m.value<=V&&performance.now()-r.value<We&&(n===s.start||n.parentNode===s.start)}function re(){Y(),window.clearTimeout(I),D=!1,s.start=null}function le(n){if(Y(),window.clearTimeout(I),D){D=!1;return}const o=ie(n.target);F=window.setTimeout(()=>{o&&X(),s.start=null},K)}function ue(n,o){window.clearTimeout(F),window.clearTimeout(I);const t=n.currentTarget;if(s.start=t,I=window.setTimeout(()=>{D=!0,P(e.onLongPress,o)},qe),se(t)){a.value>1?M():ae();return}ee(n),s.prev=t}function U(n){const{offsetWidth:o,offsetHeight:t}=n,{naturalWidth:l,naturalHeight:p}=n.querySelector(`.${J("image")}`);return{width:o,height:t,imageRadio:p/l,rootRadio:t/o,zoom:b(e.zoom)}}function ce(n){const{zoom:o,imageRadio:t,rootRadio:l,width:p,height:R}=U(n);if(!t)return 0;const L=t>l?R/t:p;return Math.max(0,(o*L-p)/2)/o}function me(n){const{zoom:o,imageRadio:t,rootRadio:l,width:p,height:R}=U(n);if(!t)return 0;const L=t>l?R:p*t;return Math.max(0,(o*L-R)/2)/o}function pe(n){if(!s.prev)return;ne(n);const o=n.currentTarget;if(m.value>V&&window.clearTimeout(I),a.value>1){const t=ce(o),l=me(o);u.value=q(u.value+z.value,-t,t),f.value=q(f.value+c.value,-l,l)}s.prev=o}function X(){if(a.value>1){M(),setTimeout(()=>P(e["onUpdate:show"],!1),_);return}P(e["onUpdate:show"],!1)}function de(n){var o;(o=w.value)==null||o.prev(n)}function ve(n){var o;(o=w.value)==null||o.next(n)}function fe(n,o){var t;(t=w.value)==null||t.to(n,o)}function he(n){e.imagePreventDefault&&e.show&&n.preventDefault()}return{swipeRef:w,isPreventDefault:te,initialIndex:oe,popupShow:i,scale:a,translateX:u,translateY:f,canSwipe:C,transitionTimingFunction:y,transitionDuration:T,n:J,classes:Xe,handleTouchstart:ue,handleTouchmove:pe,handleTouchend:le,handleTouchcancel:re,close:X,prev:de,next:ve,to:fe}}});const Ge=["onTouchstart"],Qe=["src","alt"];function Ze(e,i,a,u,f,y){const T=k("var-swipe-item"),C=k("var-swipe"),w=k("var-icon"),z=k("var-popup");return S(),A(z,{class:h(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:N(()=>[ke(C,Ne({ref:"swipeRef",class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:N(()=>[(S(!0),H($e,null,ze(e.images,(c,m)=>(S(),A(T,{class:h(e.n("swipe-item")),"var-image-preview-cover":"",key:c},{default:N(()=>[B("div",{class:h(e.n("zoom-container")),style:Le({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:r=>e.handleTouchstart(r,m),onTouchmove:i[0]||(i[0]=(...r)=>e.handleTouchmove&&e.handleTouchmove(...r)),onTouchend:i[1]||(i[1]=(...r)=>e.handleTouchend&&e.handleTouchend(...r)),onTouchcancel:i[2]||(i[2]=(...r)=>e.handleTouchcancel&&e.handleTouchcancel(...r))},[B("img",{class:h(e.classes(e.n("image"),[e.isPreventDefault,e.n("--prevent")])),src:c,alt:c},null,10,Qe)],46,Ge)]),_:2},1032,["class"]))),128))]),indicator:N(({index:c,length:m})=>[E(e.$slots,"indicator",{index:c,length:m},()=>[e.indicator&&e.images.length>1?(S(),H("div",{key:0,class:h(e.n("indicators"))},G(c+1)+" / "+G(m),3)):Q("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),E(e.$slots,"close-icon",{},()=>[e.closeable?(S(),A(w,{key:0,class:h(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):Q("",!0)]),B("div",{class:h(e.n("extra"))},[E(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const $=Re(He,[["render",Ze]]);let v,O={};function je(e={}){return Ee(e)?{...O,images:[e]}:Ve(e)?{...O,images:e}:{...O,...e}}function g(e){if(!be())return;g.close();const i=je(e),a=Ae(i);a.teleport="body",v=a;const{unmountInstance:u}=Fe($,a,{onClose:()=>P(a.onClose),onClosed:()=>{P(a.onClosed),u(),v===a&&(v=null)},onRouteChange:()=>{u(),v===a&&(v=null)},"onUpdate:show":f=>{a.show=f}});a.show=!0}g.close=()=>{if(v!=null){const e=v;v=null,Be().then(()=>{e.show=!1})}};g.setDefaultOptions=e=>{O=e};g.resetDefaultOptions=()=>{O={}};g.Component=$;x($);x($,g);export{g as I};
