import{u as oe}from"./provide-af3fae79.js";import{d as se,a as T,c as ie,w as ve}from"./components-08e741bd.js";import{d as ce,a as d,b as fe,w as F,v as de,Z as E,X as me,aK as he,aL as P,_ as pe,f as w,h as g,M as Te,O as R,N as y,R as W,F as we,ah as ge,j as ye}from"./vue-router-40fc6ea4.js";import{o as Se}from"./onSmartUnmounted-a42eb713.js";import{o as ke}from"./onWindowResize-93bafcb2.js";import{u as Ie}from"./useTouch-a4d53ac3.js";import{a as be}from"./provide-d36527af.js";const $e={loop:{type:Boolean,default:!0},autoplay:[String,Number],duration:{type:[String,Number],default:300},initialIndex:{type:[String,Number],default:0},indicator:{type:Boolean,default:!0},indicatorColor:String,vertical:Boolean,touchable:{type:Boolean,default:!0},onChange:se()},Ce=250,ze=20,{n:Ne,classes:Ee}=ie("swipe"),Pe=ce({name:"VarSwipe",props:$e,setup(e){const v=d(null),r=d(0),B=fe(()=>e.vertical),c=d(0),u=d(0),o=d(!1),l=d(0),{swipeItems:S,bindSwipeItems:M,length:t}=oe(),{popup:D,bindPopup:V}=be(),{deltaX:q,deltaY:O,moveX:j,moveY:H,offsetX:K,offsetY:U,touching:A,direction:Z,startTime:G,startTouch:J,moveTouch:Q,endTouch:_}=Ie();let L=!1,k=-1;const f=a=>S.find(({index:n})=>n.value===a),x=()=>{e.loop&&(u.value>=0&&f(t.value-1).setTranslate(-c.value),u.value<=-(c.value-r.value)&&f(0).setTranslate(c.value),u.value>-(c.value-r.value)&&u.value<0&&(f(t.value-1).setTranslate(0),f(0).setTranslate(0)))},I=a=>{const n=me(a)?a:Math.floor((u.value-r.value/2)/-r.value),{loop:i}=e;return n<=-1?i?-1:0:n>=t.value?i?t.value:t.value-1:n},ee=a=>{const{loop:n}=e;return a===-1?n?t.value-1:0:a===t.value?n?0:t.value-1:a},b=a=>e.loop?a<0?t.value+a:a>=t.value?a-t.value:a:he(a,0,t.value-1),$=async()=>{const a=u.value>=r.value,n=u.value<=-c.value,i=0,s=-(c.value-r.value);o.value=!0,(a||n)&&(o.value=!0,u.value=n?i:s,f(0).setTranslate(0),f(t.value-1).setTranslate(0)),await P(),o.value=!1},C=()=>{L||(l.value=b(E(e.initialIndex)),L=!0)},z=()=>{const{autoplay:a}=e;!a||t.value<=1||(h(),k=window.setTimeout(()=>{N(),z()},E(a)))},h=()=>{k&&clearTimeout(k)},X=a=>{u.value=a,x()},ae=async a=>{t.value<=1||!e.touchable||(J(a),h(),await $(),o.value=!0)},te=a=>{const{touchable:n,vertical:i}=e;if(!A.value||!n)return;Q(a);const s=i?"vertical":"horizontal";Z.value===s&&(a.preventDefault(),X(u.value+(i?H.value:j.value)))},le=()=>{if(!A.value)return;const{vertical:a,onChange:n}=e;_();const i=a?O.value<0:q.value<0,s=a?U.value:K.value,p=performance.now()-G.value<=Ce&&s>=ze?I(i?l.value+1:l.value-1):I();o.value=!1,X(p*-r.value);const re=l.value;l.value=ee(p),z(),re!==l.value&&T(n,l.value)},m=()=>{v.value&&(o.value=!0,r.value=e.vertical?v.value.offsetHeight:v.value.offsetWidth,c.value=r.value*t.value,u.value=l.value*-r.value,S.forEach(a=>{a.setTranslate(0)}),z(),setTimeout(()=>{o.value=!1}))},N=async a=>{if(t.value<=1)return;C();const{loop:n,onChange:i}=e,s=l.value;if(l.value=b(s+1),(a==null?void 0:a.event)!==!1&&T(i,l.value),await $(),s===t.value-1&&n){f(0).setTranslate(c.value),u.value=t.value*-r.value;return}s!==t.value-1&&(u.value=l.value*-r.value)},Y=async a=>{if(t.value<=1)return;C();const{loop:n,onChange:i}=e,s=l.value;if(l.value=b(s-1),(a==null?void 0:a.event)!==!1&&T(i,l.value),await $(),s===0&&n){f(t.value-1).setTranslate(-c.value),u.value=r.value;return}s!==0&&(u.value=l.value*-r.value)},ne=(a,n)=>{if(t.value<=1||a===l.value)return;a=a<0?0:a,a=a>=t.value?t.value:a;const i=a>l.value?N:Y,s=Math.abs(a-l.value);Array.from({length:s}).forEach((ue,p)=>{i({event:p===s-1?n==null?void 0:n.event:!1})})};return M({size:r,vertical:B}),T(V,null),F(()=>t.value,async()=>{await P(),C(),m()}),D&&F(()=>D.show.value,async a=>{a?(await P(),m()):h()}),de(m),Se(h),ke(m),{n:Ne,classes:Ee,length:t,index:l,swipeEl:v,trackSize:c,trackTranslate:u,lockDuration:o,handleTouchstart:ae,handleTouchmove:te,handleTouchend:le,next:N,prev:Y,to:ne,resize:m,toNumber:E}}});const Be=["onClick"];function De(e,v,r,B,c,u){return w(),g("div",{class:y(e.n()),ref:"swipeEl"},[Te("div",{class:y(e.classes(e.n("track"),[e.vertical,e.n("--vertical")])),style:W({width:e.vertical?void 0:`${e.trackSize}px`,height:e.vertical?`${e.trackSize}px`:void 0,transform:`translate${e.vertical?"Y":"X"}(${e.trackTranslate}px)`,transitionDuration:e.lockDuration?"0ms":`${e.toNumber(e.duration)}ms`}),onTouchstart:v[0]||(v[0]=(...o)=>e.handleTouchstart&&e.handleTouchstart(...o)),onTouchmove:v[1]||(v[1]=(...o)=>e.handleTouchmove&&e.handleTouchmove(...o)),onTouchend:v[2]||(v[2]=(...o)=>e.handleTouchend&&e.handleTouchend(...o))},[R(e.$slots,"default")],38),R(e.$slots,"indicator",{index:e.index,length:e.length},()=>[e.indicator&&e.length?(w(),g("div",{key:0,class:y(e.classes(e.n("indicators"),[e.vertical,e.n("--indicators-vertical")]))},[(w(!0),g(we,null,ge(e.length,(o,l)=>(w(),g("div",{class:y(e.classes(e.n("indicator"),[e.index===l,e.n("--indicator-active")],[e.vertical,e.n("--indicator-vertical")])),style:W({background:e.indicatorColor}),key:o,onClick:S=>e.to(l)},null,14,Be))),128))],2)):ye("",!0)])],2)}const Ae=pe(Pe,[["render",De]]);ve(Ae);export{Ae as S,$e as p};
