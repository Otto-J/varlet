import{p as me,S as pe}from"./index-5b947c28.js";import{S as de}from"./index-643b9d94.js";import{I as fe}from"./index-a00d271a.js";import{p as he,P as ve}from"./index-830ff231.js";import{d as W,p as q,i as ge,c as we,a as R,m as Te}from"./logger-928e8198.js";import{d as Ce,a as d,b as H,Z as z,w as Ie,_ as Se,p as N,f as D,i as A,S as $,q as ye,m as Pe,h as Z,F as Oe,ai as De,N as v,M as L,R as Re,O as b,Q as j,j as G,as as Ye,r as ke,n as Ne,W as $e,aA as Xe}from"./vue-router-d12202db.js";const ze={show:{type:Boolean,default:!1},imagePreventDefault:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},initialIndex:{type:[String,Number],default:0},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":W(),onLongPress:W(),...q(me,["loop","indicator","onChange"]),...q(he,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{n:Q,classes:Ae}=we("image-preview"),V=12,J=200,Le=350,K=200,be=500,Ve=Ce({name:"VarImagePreview",components:{VarSwipe:pe,VarSwipeItem:de,VarPopup:ve,VarIcon:fe},inheritAttrs:!1,props:ze,setup(e){const c=d(!1),l=H(()=>{const{images:n,current:o,initialIndex:t}=e;if(t!=null)return z(t);const i=n.findIndex(r=>r===o);return i>=0?i:0}),u=d(1),h=d(0),C=d(0),I=d(void 0),S=d(void 0),y=d(!0),w=d(null);let s=null,a=null,m=null,P=null,k=!1;const _=H(()=>{const{imagePreventDefault:n,show:o}=e;return o&&n}),X=(n,o)=>{const{clientX:t,clientY:i}=n,{clientX:r,clientY:p}=o;return Math.abs(Math.sqrt((r-t)**2+(p-i)**2))},E=(n,o)=>({clientX:n.clientX,clientY:n.clientY,timestamp:performance.now(),target:o}),x=()=>{u.value=z(e.zoom),y.value=!1,a=null,window.setTimeout(()=>{I.value="linear",S.value="0s"},K)},B=()=>{u.value=1,h.value=0,C.value=0,y.value=!0,a=null,I.value=void 0,S.value=void 0},ee=n=>a?X(a,n)<=V&&n.timestamp-a.timestamp<=J&&a.target===n.target:!1,ne=n=>!n||!s||!a?!1:X(s,a)<=V&&performance.now()-a.timestamp<Le&&(n===s.target||n.parentNode===s.target),oe=()=>{window.clearTimeout(P),k=!1,s=null},te=n=>{if(window.clearTimeout(P),k){k=!1;return}const o=ne(n.target);m=window.setTimeout(()=>{o&&U(),s=null},J)},ae=(n,o)=>{window.clearTimeout(m),window.clearTimeout(P);const t=E(n.touches[0],n.currentTarget);if(s=t,P=window.setTimeout(()=>{const{onLongPress:i}=e;k=!0,R(i,o)},be),ee(t)){u.value>1?B():x();return}a=t},F=n=>{const{offsetWidth:o,offsetHeight:t}=n,{naturalWidth:i,naturalHeight:r}=n.querySelector(`.${Q("image")}`);return{width:o,height:t,imageRadio:r/i,rootRadio:t/o,zoom:z(e.zoom)}},se=n=>{const{zoom:o,imageRadio:t,rootRadio:i,width:r,height:p}=F(n);if(!t)return 0;const O=t>i?p/t:r;return Math.max(0,(o*O-r)/2)/o},ie=n=>{const{zoom:o,imageRadio:t,rootRadio:i,width:r,height:p}=F(n);if(!t)return 0;const O=t>i?p:r*t;return Math.max(0,(o*O-p)/2)/o},M=(n,o,t)=>n+o>=t?t:n+o<=-t?-t:n+o,le=n=>{if(!a)return;const o=n.currentTarget,t=E(n.touches[0],o);if(X(t,a)>V&&window.clearTimeout(P),u.value>1){const i=t.clientX-a.clientX,r=t.clientY-a.clientY,p=se(o),O=ie(o);h.value=M(h.value,i,p),C.value=M(C.value,r,O)}a=t},U=()=>{if(u.value>1){B(),setTimeout(()=>R(e["onUpdate:show"],!1),K);return}R(e["onUpdate:show"],!1)},re=n=>{var o;(o=w.value)==null||o.prev(n)},ce=n=>{var o;(o=w.value)==null||o.next(n)},ue=(n,o)=>{var t;(t=w.value)==null||t.to(n,o)};return ge(()=>document,"contextmenu",n=>{e.imagePreventDefault&&e.show&&n.preventDefault()}),Ie(()=>e.show,n=>{c.value=n},{immediate:!0}),{n:Q,classes:Ae,swipeRef:w,isPreventDefault:_,initialIndex:l,popupShow:c,scale:u,translateX:h,translateY:C,canSwipe:y,transitionTimingFunction:I,transitionDuration:S,handleTouchstart:ae,handleTouchmove:le,handleTouchend:te,handleTouchcancel:oe,close:U,prev:re,next:ce,to:ue}}});const Ee=["onTouchstart"],Be=["src","alt"];function Fe(e,c,l,u,h,C){const I=N("var-swipe-item"),S=N("var-swipe"),y=N("var-icon"),w=N("var-popup");return D(),A(w,{class:v(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:$(()=>[ye(S,Pe({ref:"swipeRef",class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:$(()=>[(D(!0),Z(Oe,null,De(e.images,(s,a)=>(D(),A(I,{class:v(e.n("swipe-item")),"var-image-preview-cover":"",key:s},{default:$(()=>[L("div",{class:v(e.n("zoom-container")),style:Re({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:m=>e.handleTouchstart(m,a),onTouchmove:c[0]||(c[0]=(...m)=>e.handleTouchmove&&e.handleTouchmove(...m)),onTouchend:c[1]||(c[1]=(...m)=>e.handleTouchend&&e.handleTouchend(...m)),onTouchcancel:c[2]||(c[2]=(...m)=>e.handleTouchcancel&&e.handleTouchcancel(...m))},[L("img",{class:v(e.classes(e.n("image"),[e.isPreventDefault,e.n("--prevent")])),src:s,alt:s},null,10,Be)],46,Ee)]),_:2},1032,["class"]))),128))]),indicator:$(({index:s,length:a})=>[b(e.$slots,"indicator",{index:s,length:a},()=>[e.indicator&&e.images.length>1?(D(),Z("div",{key:0,class:v(e.n("indicators"))},j(s+1)+" / "+j(a),3)):G("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),b(e.$slots,"close-icon",{},()=>[e.closeable?(D(),A(y,{key:0,class:v(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):G("",!0)]),L("div",{class:v(e.n("extra"))},[b(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const g=Se(Ve,[["render",Fe]]);let f,Y={};function Me(e={}){return $e(e)?{...Y,images:[e]}:Xe(e)?{...Y,images:e}:{...Y,...e}}function T(e){if(!Ye())return;T.close();const c=Me(e),l=ke(c);l.teleport="body",f=l;const{unmountInstance:u}=Te(g,l,{onClose:()=>R(l.onClose),onClosed:()=>{R(l.onClosed),u(),f===l&&(f=null)},onRouteChange:()=>{u(),f===l&&(f=null)},"onUpdate:show":h=>{l.show=h}});l.show=!0}T.close=()=>{if(f!=null){const e=f;f=null,Ne().then(()=>{e.show=!1})}};T.setDefaultOptions=e=>{Y=e};T.resetDefaultOptions=()=>{Y={}};g.install=function(e){e.component(g.name,g)};T.install=function(e){e.component(g.name,g)};T.Component=g;export{T as I};
