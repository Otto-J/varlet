import{u as le}from"./provide-0edf30e7.js";import{v as oe,e as j}from"./elements-951374bf.js";import{d as re,a as g,c as ue}from"./logger-583ae699.js";import{d as se,a as T,b as ie,w as H,v as ve,Z as A,X as ce,aI as fe,_ as de,f as k,h as C,M as me,O,N as $,R as U,F as he,ai as pe,j as Te}from"./vue-router-68a7ea4f.js";import{o as we}from"./onSmartUnmounted-9d4d0723.js";import{o as ge}from"./onWindowResize-91edecaa.js";import{a as Se}from"./provide-73147e91.js";const ye={loop:{type:Boolean,default:!0},autoplay:{type:[String,Number]},duration:{type:[String,Number],default:300},initialIndex:{type:[String,Number],default:0},indicator:{type:Boolean,default:!0},indicatorColor:{type:String},vertical:{type:Boolean,default:!1},touchable:{type:Boolean,default:!0},onChange:re()},be=250,Ie=20,{n:ke,classes:Ce}=ue("swipe"),$e=se({name:"VarSwipe",props:ye,setup(e){const v=T(null),s=T(0),R=ie(()=>e.vertical),c=T(0),u=T(0),i=T(!1),l=T(0),{swipeItems:z,bindSwipeItems:Z,length:n}=le(),{popup:W,bindPopup:G}=Se();let F=!1,S=!1,N=-1,y,b,V,m,h;const f=a=>z.find(({index:t})=>t.value===a),J=()=>{e.loop&&(u.value>=0&&f(n.value-1).setTranslate(-c.value),u.value<=-(c.value-s.value)&&f(0).setTranslate(c.value),u.value>-(c.value-s.value)&&u.value<0&&(f(n.value-1).setTranslate(0),f(0).setTranslate(0)))},D=a=>{const t=ce(a)?a:Math.floor((u.value-s.value/2)/-s.value),{loop:o}=e;return t<=-1?o?-1:0:t>=n.value?o?n.value:n.value-1:t},K=a=>{const{loop:t}=e;return a===-1?t?n.value-1:0:a===n.value?t?0:n.value-1:a},E=a=>e.loop?a<0?n.value+a:a>=n.value?a-n.value:a:fe(a,0,n.value-1),B=a=>{const t=u.value>=s.value,o=u.value<=-c.value,r=0,d=-(c.value-s.value);i.value=!0,(t||o)&&(i.value=!0,u.value=o?r:d,f(0).setTranslate(0),f(n.value-1).setTranslate(0)),oe(()=>{i.value=!1,g(a)})},P=()=>{F||(l.value=E(A(e.initialIndex)),F=!0)},X=()=>{const{autoplay:a}=e;!a||n.value<=1||(I(),N=window.setTimeout(()=>{Y(),X()},A(a)))},I=()=>{N&&clearTimeout(N)},Q=(a,t)=>{if(a>t&&a>10)return"horizontal";if(t>a&&t>10)return"vertical"},_=a=>{if(n.value<=1||!e.touchable)return;const{clientX:t,clientY:o}=a.touches[0];y=t,b=o,V=performance.now(),S=!0,I(),B(()=>{i.value=!0})},x=a=>{const{touchable:t,vertical:o}=e;if(!S||!t)return;const{clientX:r,clientY:d}=a.touches[0],p=Math.abs(r-y),M=Math.abs(d-b);if(Q(p,M)===(o?"vertical":"horizontal")){a.preventDefault();const te=m!==void 0?r-m:0,ne=h!==void 0?d-h:0;m=r,h=d,u.value+=o?ne:te,J()}},ee=()=>{if(!S)return;const{vertical:a,onChange:t}=e,o=a?h<b:m<y,r=Math.abs(a?b-h:y-m),p=performance.now()-V<=be&&r>=Ie?D(o?l.value+1:l.value-1):D();S=!1,i.value=!1,m=void 0,h=void 0,u.value=p*-s.value;const M=l.value;l.value=K(p),X(),M!==l.value&&g(t,l.value)},w=()=>{v.value&&(i.value=!0,s.value=e.vertical?v.value.offsetHeight:v.value.offsetWidth,c.value=s.value*n.value,u.value=l.value*-s.value,z.forEach(a=>{a.setTranslate(0)}),X(),setTimeout(()=>{i.value=!1}))},Y=a=>{if(n.value<=1)return;P();const{loop:t,onChange:o}=e,r=l.value;l.value=E(r+1),(a==null?void 0:a.event)!==!1&&g(o,l.value),B(()=>{if(r===n.value-1&&t){f(0).setTranslate(c.value),u.value=n.value*-s.value;return}r!==n.value-1&&(u.value=l.value*-s.value)})},q=a=>{if(n.value<=1)return;P();const{loop:t,onChange:o}=e,r=l.value;l.value=E(r-1),(a==null?void 0:a.event)!==!1&&g(o,l.value),B(()=>{if(r===0&&t){f(n.value-1).setTranslate(-c.value),u.value=s.value;return}r!==0&&(u.value=l.value*-s.value)})},ae=(a,t)=>{if(n.value<=1||a===l.value)return;a=a<0?0:a,a=a>=n.value?n.value:a;const o=a>l.value?Y:q,r=Math.abs(a-l.value);Array.from({length:r}).forEach((d,p)=>{o({event:p===r-1?t==null?void 0:t.event:!1})})};return Z({size:s,vertical:R}),g(G,null),H(()=>n.value,async()=>{await j(),P(),w()}),W&&H(()=>W.show.value,async a=>{a?(await j(),w()):I()}),ve(w),we(I),ge(w),{n:ke,classes:Ce,length:n,index:l,swipeEl:v,trackSize:c,translate:u,lockDuration:i,handleTouchstart:_,handleTouchmove:x,handleTouchend:ee,next:Y,prev:q,to:ae,resize:w,toNumber:A}}});const ze=["onClick"];function Ne(e,v,s,R,c,u){return k(),C("div",{class:$(e.n()),ref:"swipeEl"},[me("div",{class:$(e.classes(e.n("track"),[e.vertical,e.n("--vertical")])),style:U({width:e.vertical?void 0:`${e.trackSize}px`,height:e.vertical?`${e.trackSize}px`:void 0,transform:`translate${e.vertical?"Y":"X"}(${e.translate}px)`,transitionDuration:e.lockDuration?"0ms":`${e.toNumber(e.duration)}ms`}),onTouchstart:v[0]||(v[0]=(...i)=>e.handleTouchstart&&e.handleTouchstart(...i)),onTouchmove:v[1]||(v[1]=(...i)=>e.handleTouchmove&&e.handleTouchmove(...i)),onTouchend:v[2]||(v[2]=(...i)=>e.handleTouchend&&e.handleTouchend(...i))},[O(e.$slots,"default")],38),O(e.$slots,"indicator",{index:e.index,length:e.length},()=>[e.indicator&&e.length?(k(),C("div",{key:0,class:$(e.classes(e.n("indicators"),[e.vertical,e.n("--indicators-vertical")]))},[(k(!0),C(he,null,pe(e.length,(i,l)=>(k(),C("div",{class:$(e.classes(e.n("indicator"),[e.index===l,e.n("--indicator-active")],[e.vertical,e.n("--indicator-vertical")])),style:U({background:e.indicatorColor}),key:i,onClick:z=>e.to(l)},null,14,ze))),128))],2)):Te("",!0)])],2)}const L=de($e,[["render",Ne]]);L.install=function(e){e.component(L.name,L)};export{L as S,ye as p};
