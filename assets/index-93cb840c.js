import{d as E,i as v,f as k}from"./elements-c49c9cb9.js";import{aB as w,aL as d}from"./vue-router-2f4e575c.js";import{c as I}from"./shared-d7304ff5.js";import{a as b}from"./components-a6c6deca.js";const O="background-image",R="lazy-loading",W="lazy-error",m="lazy-attempt",B=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],u="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",n=[],c=[],y=I(100),e={loading:u,error:u,attempt:3,throttleWait:300,events:B};let A=d(o,e.throttleWait);function s(t,a){t._lazy.arg===O?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function C(t){t._lazy.loading&&s(t,t._lazy.loading),o()}function G(t){t._lazy.error&&s(t,t._lazy.error),t._lazy.state="error",f(t),o()}function p(t,a){s(t,a),t._lazy.state="success",f(t),o()}function N(t){var a;c.includes(t)||(c.push(t),(a=e.events)==null||a.forEach(r=>{t.addEventListener(r,A,{passive:!0})}))}function P(){c.forEach(t=>{var a;(a=e.events)==null||a.forEach(r=>{t.removeEventListener(r,A)})}),c.length=0}function T(t,a){const r={loading:t.getAttribute(R)??e.loading,error:t.getAttribute(W)??e.error,attempt:t.getAttribute(m)?Number(t.getAttribute(m)):e.attempt};t._lazy={src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1,...r},s(t,u),b(e.filter,t._lazy)}function D(t,a){const r=new Image;r.src=a,t._lazy.preloadImage=r,r.addEventListener("load",()=>{t._lazy.attemptLock=!1,y.add(a),p(t,a)}),r.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?G(t):z(t)})}function z(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(y.has(a)){p(t,a),t._lazy.attemptLock=!1;return}C(t),D(t,a)}async function l(t){await E(),v(t)&&z(t)}function o(){n.forEach(t=>l(t))}async function M(t){!n.includes(t)&&n.push(t),k(t).forEach(N),await l(t)}function f(t){w(n,t),n.length===0&&P()}function S(t,a){const{src:r,arg:i}=t._lazy;return r!==a.value||i!==a.arg}async function g(t,a){T(t,a),await M(t)}async function Y(t,a){if(!S(t,a)){n.includes(t)&&await l(t);return}await g(t,a)}function Z(t={}){const{events:a,loading:r,error:i,attempt:h,throttleWait:_,filter:L}=t;e.events=a??e.events,e.loading=r??e.loading,e.error=i??e.error,e.attempt=h??e.attempt,e.throttleWait=_??e.throttleWait,e.filter=L}const V={mounted:g,unmounted:f,updated:Y,install(t,a){Z(a),A=d(o,e.throttleWait),t.directive("lazy",this)}},U=V;export{U as v};
