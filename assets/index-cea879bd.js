import{u as le}from"./provide-b9f6be72.js";import{v as ne,e as q}from"./elements-dd38e0fd.js";import{d as re,a as g,c as oe,w as ue}from"./logger-5e844ee5.js";import{d as se,a as T,b as ie,w as H,v as ve,Z as A,X as ce,aH as fe,_ as de,f as k,h as C,M as me,O as j,N as $,R as O,F as he,ah as pe,j as Te}from"./vue-router-0425d5ec.js";import{o as we}from"./onSmartUnmounted-16d0dd74.js";import{o as ge}from"./onWindowResize-8116aeba.js";import{a as Se}from"./provide-5916ac1c.js";const ye={loop:{type:Boolean,default:!0},autoplay:{type:[String,Number]},duration:{type:[String,Number],default:300},initialIndex:{type:[String,Number],default:0},indicator:{type:Boolean,default:!0},indicatorColor:{type:String},vertical:{type:Boolean,default:!1},touchable:{type:Boolean,default:!0},onChange:re()},be=250,Ie=20,{n:ke,classes:Ce}=oe("swipe"),$e=se({name:"VarSwipe",props:ye,setup(a){const v=T(null),s=T(0),L=ie(()=>a.vertical),c=T(0),u=T(0),i=T(!1),n=T(0),{swipeItems:z,bindSwipeItems:U,length:l}=le(),{popup:R,bindPopup:Z}=Se();let W=!1,S=!1,N=-1,y,b,F,m,h;const f=e=>z.find(({index:t})=>t.value===e),G=()=>{a.loop&&(u.value>=0&&f(l.value-1).setTranslate(-c.value),u.value<=-(c.value-s.value)&&f(0).setTranslate(c.value),u.value>-(c.value-s.value)&&u.value<0&&(f(l.value-1).setTranslate(0),f(0).setTranslate(0)))},D=e=>{const t=ce(e)?e:Math.floor((u.value-s.value/2)/-s.value),{loop:r}=a;return t<=-1?r?-1:0:t>=l.value?r?l.value:l.value-1:t},J=e=>{const{loop:t}=a;return e===-1?t?l.value-1:0:e===l.value?t?0:l.value-1:e},E=e=>a.loop?e<0?l.value+e:e>=l.value?e-l.value:e:fe(e,0,l.value-1),B=e=>{const t=u.value>=s.value,r=u.value<=-c.value,o=0,d=-(c.value-s.value);i.value=!0,(t||r)&&(i.value=!0,u.value=r?o:d,f(0).setTranslate(0),f(l.value-1).setTranslate(0)),ne(()=>{i.value=!1,g(e)})},P=()=>{W||(n.value=E(A(a.initialIndex)),W=!0)},X=()=>{const{autoplay:e}=a;!e||l.value<=1||(I(),N=window.setTimeout(()=>{Y(),X()},A(e)))},I=()=>{N&&clearTimeout(N)},K=(e,t)=>{if(e>t&&e>10)return"horizontal";if(t>e&&t>10)return"vertical"},Q=e=>{if(l.value<=1||!a.touchable)return;const{clientX:t,clientY:r}=e.touches[0];y=t,b=r,F=performance.now(),S=!0,I(),B(()=>{i.value=!0})},_=e=>{const{touchable:t,vertical:r}=a;if(!S||!t)return;const{clientX:o,clientY:d}=e.touches[0],p=Math.abs(o-y),M=Math.abs(d-b);if(K(p,M)===(r?"vertical":"horizontal")){e.preventDefault();const ae=m!==void 0?o-m:0,te=h!==void 0?d-h:0;m=o,h=d,u.value+=r?te:ae,G()}},x=()=>{if(!S)return;const{vertical:e,onChange:t}=a,r=e?h<b:m<y,o=Math.abs(e?b-h:y-m),p=performance.now()-F<=be&&o>=Ie?D(r?n.value+1:n.value-1):D();S=!1,i.value=!1,m=void 0,h=void 0,u.value=p*-s.value;const M=n.value;n.value=J(p),X(),M!==n.value&&g(t,n.value)},w=()=>{v.value&&(i.value=!0,s.value=a.vertical?v.value.offsetHeight:v.value.offsetWidth,c.value=s.value*l.value,u.value=n.value*-s.value,z.forEach(e=>{e.setTranslate(0)}),X(),setTimeout(()=>{i.value=!1}))},Y=e=>{if(l.value<=1)return;P();const{loop:t,onChange:r}=a,o=n.value;n.value=E(o+1),(e==null?void 0:e.event)!==!1&&g(r,n.value),B(()=>{if(o===l.value-1&&t){f(0).setTranslate(c.value),u.value=l.value*-s.value;return}o!==l.value-1&&(u.value=n.value*-s.value)})},V=e=>{if(l.value<=1)return;P();const{loop:t,onChange:r}=a,o=n.value;n.value=E(o-1),(e==null?void 0:e.event)!==!1&&g(r,n.value),B(()=>{if(o===0&&t){f(l.value-1).setTranslate(-c.value),u.value=s.value;return}o!==0&&(u.value=n.value*-s.value)})},ee=(e,t)=>{if(l.value<=1||e===n.value)return;e=e<0?0:e,e=e>=l.value?l.value:e;const r=e>n.value?Y:V,o=Math.abs(e-n.value);Array.from({length:o}).forEach((d,p)=>{r({event:p===o-1?t==null?void 0:t.event:!1})})};return U({size:s,vertical:L}),g(Z,null),H(()=>l.value,async()=>{await q(),P(),w()}),R&&H(()=>R.show.value,async e=>{e?(await q(),w()):I()}),ve(w),we(I),ge(w),{n:ke,classes:Ce,length:l,index:n,swipeEl:v,trackSize:c,translate:u,lockDuration:i,handleTouchstart:Q,handleTouchmove:_,handleTouchend:x,next:Y,prev:V,to:ee,resize:w,toNumber:A}}});const ze=["onClick"];function Ne(a,v,s,L,c,u){return k(),C("div",{class:$(a.n()),ref:"swipeEl"},[me("div",{class:$(a.classes(a.n("track"),[a.vertical,a.n("--vertical")])),style:O({width:a.vertical?void 0:`${a.trackSize}px`,height:a.vertical?`${a.trackSize}px`:void 0,transform:`translate${a.vertical?"Y":"X"}(${a.translate}px)`,transitionDuration:a.lockDuration?"0ms":`${a.toNumber(a.duration)}ms`}),onTouchstart:v[0]||(v[0]=(...i)=>a.handleTouchstart&&a.handleTouchstart(...i)),onTouchmove:v[1]||(v[1]=(...i)=>a.handleTouchmove&&a.handleTouchmove(...i)),onTouchend:v[2]||(v[2]=(...i)=>a.handleTouchend&&a.handleTouchend(...i))},[j(a.$slots,"default")],38),j(a.$slots,"indicator",{index:a.index,length:a.length},()=>[a.indicator&&a.length?(k(),C("div",{key:0,class:$(a.classes(a.n("indicators"),[a.vertical,a.n("--indicators-vertical")]))},[(k(!0),C(he,null,pe(a.length,(i,n)=>(k(),C("div",{class:$(a.classes(a.n("indicator"),[a.index===n,a.n("--indicator-active")],[a.vertical,a.n("--indicator-vertical")])),style:O({background:a.indicatorColor}),key:i,onClick:z=>a.to(n)},null,14,ze))),128))],2)):Te("",!0)])],2)}const De=de($e,[["render",Ne]]);ue(De);export{De as S,ye as p};
