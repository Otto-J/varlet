import{p as pe,S as de}from"./index-487a7fcc.js";import{S as he}from"./index-8e4fe0c2.js";import{I as fe}from"./index-cee312b2.js";import{p as ve,P as ge}from"./index-45347b09.js";import{d as q,p as W,i as we,c as Te,a as D,m as Ce,w as _}from"./logger-5e844ee5.js";import{d as Ie,a as d,b as H,Z as z,w as Se,_ as ye,p as k,f as O,i as L,S as N,q as Pe,m as Oe,h as Z,F as De,ah as Re,N as v,M as b,R as Ye,O as A,Q as j,j as G,aq as ke,r as Ne,n as $e,W as Xe,av as ze}from"./vue-router-0425d5ec.js";const Le={show:{type:Boolean,default:!1},imagePreventDefault:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},initialIndex:{type:[String,Number],default:0},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":q(),onLongPress:q(),...W(pe,["loop","indicator","onChange"]),...W(ve,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{n:Q,classes:be}=Te("image-preview"),V=12,J=200,Ae=350,K=200,Ve=500,Ee=Ie({name:"VarImagePreview",components:{VarSwipe:de,VarSwipeItem:he,VarPopup:ge,VarIcon:fe},inheritAttrs:!1,props:Le,setup(e){const c=d(!1),r=H(()=>{const{images:n,current:o,initialIndex:t}=e;if(t!=null)return z(t);const i=n.findIndex(l=>l===o);return i>=0?i:0}),u=d(1),f=d(0),T=d(0),C=d(void 0),I=d(void 0),S=d(!0),g=d(null);let s=null,a=null,m=null,y=null,Y=!1;const x=H(()=>{const{imagePreventDefault:n,show:o}=e;return o&&n}),X=(n,o)=>{const{clientX:t,clientY:i}=n,{clientX:l,clientY:p}=o;return Math.abs(Math.sqrt((l-t)**2+(p-i)**2))},E=(n,o)=>({clientX:n.clientX,clientY:n.clientY,timestamp:performance.now(),target:o}),ee=()=>{u.value=z(e.zoom),S.value=!1,a=null,window.setTimeout(()=>{C.value="linear",I.value="0s"},K)},B=()=>{u.value=1,f.value=0,T.value=0,S.value=!0,a=null,C.value=void 0,I.value=void 0},ne=n=>a?X(a,n)<=V&&n.timestamp-a.timestamp<=J&&a.target===n.target:!1,oe=n=>!n||!s||!a?!1:X(s,a)<=V&&performance.now()-a.timestamp<Ae&&(n===s.target||n.parentNode===s.target),te=()=>{window.clearTimeout(y),Y=!1,s=null},ae=n=>{if(window.clearTimeout(y),Y){Y=!1;return}const o=oe(n.target);m=window.setTimeout(()=>{o&&U(),s=null},J)},se=(n,o)=>{window.clearTimeout(m),window.clearTimeout(y);const t=E(n.touches[0],n.currentTarget);if(s=t,y=window.setTimeout(()=>{const{onLongPress:i}=e;Y=!0,D(i,o)},Ve),ne(t)){u.value>1?B():ee();return}a=t},F=n=>{const{offsetWidth:o,offsetHeight:t}=n,{naturalWidth:i,naturalHeight:l}=n.querySelector(`.${Q("image")}`);return{width:o,height:t,imageRadio:l/i,rootRadio:t/o,zoom:z(e.zoom)}},ie=n=>{const{zoom:o,imageRadio:t,rootRadio:i,width:l,height:p}=F(n);if(!t)return 0;const P=t>i?p/t:l;return Math.max(0,(o*P-l)/2)/o},re=n=>{const{zoom:o,imageRadio:t,rootRadio:i,width:l,height:p}=F(n);if(!t)return 0;const P=t>i?p:l*t;return Math.max(0,(o*P-p)/2)/o},M=(n,o,t)=>n+o>=t?t:n+o<=-t?-t:n+o,le=n=>{if(!a)return;const o=n.currentTarget,t=E(n.touches[0],o);if(X(t,a)>V&&window.clearTimeout(y),u.value>1){const i=t.clientX-a.clientX,l=t.clientY-a.clientY,p=ie(o),P=re(o);f.value=M(f.value,i,p),T.value=M(T.value,l,P)}a=t},U=()=>{if(u.value>1){B(),setTimeout(()=>D(e["onUpdate:show"],!1),K);return}D(e["onUpdate:show"],!1)},ce=n=>{var o;(o=g.value)==null||o.prev(n)},ue=n=>{var o;(o=g.value)==null||o.next(n)},me=(n,o)=>{var t;(t=g.value)==null||t.to(n,o)};return we(()=>document,"contextmenu",n=>{e.imagePreventDefault&&e.show&&n.preventDefault()}),Se(()=>e.show,n=>{c.value=n},{immediate:!0}),{n:Q,classes:be,swipeRef:g,isPreventDefault:x,initialIndex:r,popupShow:c,scale:u,translateX:f,translateY:T,canSwipe:S,transitionTimingFunction:C,transitionDuration:I,handleTouchstart:se,handleTouchmove:le,handleTouchend:ae,handleTouchcancel:te,close:U,prev:ce,next:ue,to:me}}});const Be=["onTouchstart"],Fe=["src","alt"];function Me(e,c,r,u,f,T){const C=k("var-swipe-item"),I=k("var-swipe"),S=k("var-icon"),g=k("var-popup");return O(),L(g,{class:v(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:N(()=>[Pe(I,Oe({ref:"swipeRef",class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:N(()=>[(O(!0),Z(De,null,Re(e.images,(s,a)=>(O(),L(C,{class:v(e.n("swipe-item")),"var-image-preview-cover":"",key:s},{default:N(()=>[b("div",{class:v(e.n("zoom-container")),style:Ye({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:m=>e.handleTouchstart(m,a),onTouchmove:c[0]||(c[0]=(...m)=>e.handleTouchmove&&e.handleTouchmove(...m)),onTouchend:c[1]||(c[1]=(...m)=>e.handleTouchend&&e.handleTouchend(...m)),onTouchcancel:c[2]||(c[2]=(...m)=>e.handleTouchcancel&&e.handleTouchcancel(...m))},[b("img",{class:v(e.classes(e.n("image"),[e.isPreventDefault,e.n("--prevent")])),src:s,alt:s},null,10,Fe)],46,Be)]),_:2},1032,["class"]))),128))]),indicator:N(({index:s,length:a})=>[A(e.$slots,"indicator",{index:s,length:a},()=>[e.indicator&&e.images.length>1?(O(),Z("div",{key:0,class:v(e.n("indicators"))},j(s+1)+" / "+j(a),3)):G("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),A(e.$slots,"close-icon",{},()=>[e.closeable?(O(),L(S,{key:0,class:v(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):G("",!0)]),b("div",{class:v(e.n("extra"))},[A(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const $=ye(Ee,[["render",Me]]);let h,R={};function Ue(e={}){return Xe(e)?{...R,images:[e]}:ze(e)?{...R,images:e}:{...R,...e}}function w(e){if(!ke())return;w.close();const c=Ue(e),r=Ne(c);r.teleport="body",h=r;const{unmountInstance:u}=Ce($,r,{onClose:()=>D(r.onClose),onClosed:()=>{D(r.onClosed),u(),h===r&&(h=null)},onRouteChange:()=>{u(),h===r&&(h=null)},"onUpdate:show":f=>{r.show=f}});r.show=!0}w.close=()=>{if(h!=null){const e=h;h=null,$e().then(()=>{e.show=!1})}};w.setDefaultOptions=e=>{R=e};w.resetDefaultOptions=()=>{R={}};w.Component=$;_($);_($,w);export{w as I};
