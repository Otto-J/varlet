import{p as he,S as fe}from"./index-5562fa0d.js";import{S as we}from"./index-40ef7b08.js";import{I as ge}from"./index-5ae50cc0.js";import{p as Te,P as Ce}from"./index-10ae05c8.js";import{d as Ie,a as d,b as X,Z as A,w as Se,aH as H,_ as ye,p as k,f as S,i as b,S as N,q as Pe,m as Oe,h as W,F as De,ah as Re,N as f,M as E,R as ke,O as V,Q as q,j as Z,aq as Ne,r as $e,n as ze,W as Le,av as Ae}from"./vue-router-547718df.js";import{d as j,p as G,i as be,c as Ee,a as y,m as Ve,w as _}from"./logger-9a144f5d.js";import{u as Be}from"./useTouch-4ef72608.js";const Ye={show:{type:Boolean,default:!1},imagePreventDefault:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},initialIndex:{type:[String,Number],default:0},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":j(),onLongPress:j(),...G(he,["loop","indicator","onChange"]),...G(Te,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{n:Q,classes:Fe}=Ee("image-preview"),B=12,J=200,Me=350,K=200,Ue=500,Xe=Ie({name:"VarImagePreview",components:{VarSwipe:fe,VarSwipeItem:we,VarPopup:Ce,VarIcon:ge},inheritAttrs:!1,props:Ye,setup(e){const r=d(!1),a=d(1),u=d(0),h=d(0),O=d(void 0),T=d(void 0),C=d(!0),w=d(null),{moveX:z,moveY:c,distance:m,startTime:i,startTouch:x,moveTouch:ee}=Be(),s={start:null,prev:null};let Y=null,I=null,D=!1;const oe=X(()=>{const{images:o,current:n,initialIndex:t}=e;if(t!=null)return A(t);const l=o.findIndex(p=>p===n);return Math.max(l,0)}),ne=X(()=>{const{imagePreventDefault:o,show:n}=e;return n&&o}),te=()=>{a.value=A(e.zoom),C.value=!1,s.prev=null,window.setTimeout(()=>{O.value="linear",T.value="0s"},K)},F=()=>{a.value=1,u.value=0,h.value=0,C.value=!0,s.prev=null,O.value=void 0,T.value=void 0},ae=o=>s.prev?m.value<=B&&performance.now()-i.value<=J&&s.prev===o:!1,se=o=>!o||!s.start||!s.prev?!1:m.value<=B&&performance.now()-i.value<Me&&(o===s.start||o.parentNode===s.start),re=()=>{window.clearTimeout(I),D=!1,s.start=null},ie=o=>{if(window.clearTimeout(I),D){D=!1;return}const n=se(o.target);Y=window.setTimeout(()=>{n&&U(),s.start=null},J)},le=(o,n)=>{window.clearTimeout(Y),window.clearTimeout(I);const t=o.currentTarget;if(s.start=t,I=window.setTimeout(()=>{D=!0,y(e.onLongPress,n)},Ue),ae(t)){a.value>1?F():te();return}x(o),s.prev=t},M=o=>{const{offsetWidth:n,offsetHeight:t}=o,{naturalWidth:l,naturalHeight:p}=o.querySelector(`.${Q("image")}`);return{width:n,height:t,imageRadio:p/l,rootRadio:t/n,zoom:A(e.zoom)}},ue=o=>{const{zoom:n,imageRadio:t,rootRadio:l,width:p,height:R}=M(o);if(!t)return 0;const L=t>l?R/t:p;return Math.max(0,(n*L-p)/2)/n},ce=o=>{const{zoom:n,imageRadio:t,rootRadio:l,width:p,height:R}=M(o);if(!t)return 0;const L=t>l?R:p*t;return Math.max(0,(n*L-R)/2)/n},me=o=>{if(!s.prev)return;ee(o);const n=o.currentTarget;if(m.value>B&&window.clearTimeout(I),a.value>1){const t=ue(n),l=ce(n);u.value=H(u.value+z.value,-t,t),h.value=H(h.value+c.value,-l,l)}s.prev=n},U=()=>{if(a.value>1){F(),setTimeout(()=>y(e["onUpdate:show"],!1),K);return}y(e["onUpdate:show"],!1)},pe=o=>{var n;(n=w.value)==null||n.prev(o)},de=o=>{var n;(n=w.value)==null||n.next(o)},ve=(o,n)=>{var t;(t=w.value)==null||t.to(o,n)};return be(()=>document,"contextmenu",o=>{e.imagePreventDefault&&e.show&&o.preventDefault()}),Se(()=>e.show,o=>{r.value=o},{immediate:!0}),{n:Q,classes:Fe,swipeRef:w,isPreventDefault:ne,initialIndex:oe,popupShow:r,scale:a,translateX:u,translateY:h,canSwipe:C,transitionTimingFunction:O,transitionDuration:T,handleTouchstart:le,handleTouchmove:me,handleTouchend:ie,handleTouchcancel:re,close:U,prev:pe,next:de,to:ve}}});const He=["onTouchstart"],We=["src","alt"];function qe(e,r,a,u,h,O){const T=k("var-swipe-item"),C=k("var-swipe"),w=k("var-icon"),z=k("var-popup");return S(),b(z,{class:f(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:N(()=>[Pe(C,Oe({ref:"swipeRef",class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:N(()=>[(S(!0),W(De,null,Re(e.images,(c,m)=>(S(),b(T,{class:f(e.n("swipe-item")),"var-image-preview-cover":"",key:c},{default:N(()=>[E("div",{class:f(e.n("zoom-container")),style:ke({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:i=>e.handleTouchstart(i,m),onTouchmove:r[0]||(r[0]=(...i)=>e.handleTouchmove&&e.handleTouchmove(...i)),onTouchend:r[1]||(r[1]=(...i)=>e.handleTouchend&&e.handleTouchend(...i)),onTouchcancel:r[2]||(r[2]=(...i)=>e.handleTouchcancel&&e.handleTouchcancel(...i))},[E("img",{class:f(e.classes(e.n("image"),[e.isPreventDefault,e.n("--prevent")])),src:c,alt:c},null,10,We)],46,He)]),_:2},1032,["class"]))),128))]),indicator:N(({index:c,length:m})=>[V(e.$slots,"indicator",{index:c,length:m},()=>[e.indicator&&e.images.length>1?(S(),W("div",{key:0,class:f(e.n("indicators"))},q(c+1)+" / "+q(m),3)):Z("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),V(e.$slots,"close-icon",{},()=>[e.closeable?(S(),b(w,{key:0,class:f(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):Z("",!0)]),E("div",{class:f(e.n("extra"))},[V(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const $=ye(Xe,[["render",qe]]);let v,P={};function Ze(e={}){return Le(e)?{...P,images:[e]}:Ae(e)?{...P,images:e}:{...P,...e}}function g(e){if(!Ne())return;g.close();const r=Ze(e),a=$e(r);a.teleport="body",v=a;const{unmountInstance:u}=Ve($,a,{onClose:()=>y(a.onClose),onClosed:()=>{y(a.onClosed),u(),v===a&&(v=null)},onRouteChange:()=>{u(),v===a&&(v=null)},"onUpdate:show":h=>{a.show=h}});a.show=!0}g.close=()=>{if(v!=null){const e=v;v=null,ze().then(()=>{e.show=!1})}};g.setDefaultOptions=e=>{P=e};g.resetDefaultOptions=()=>{P={}};g.Component=$;_($);_($,g);export{g as I};
