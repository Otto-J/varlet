import{p as re,S as le}from"./index-546b0379.js";import{S as ce}from"./index-ebfac036.js";import{I as ue}from"./index-01c5ce39.js";import{p as me,P as pe}from"./index-4bd5db23.js";import{d as M,p as U,j as de,c as he,a as D,m as fe}from"./logger-259930a0.js";import{d as ve,a as v,b as W,w as ge,Z as q,_ as we,p as k,f as O,i as X,S as $,q as Te,m as Ce,h as H,F as Se,ai as Ie,N as g,M as z,R as Pe,O as A,Q as j,j as Z,as as ye,r as Oe,n as De,W as Re,aA as Ye}from"./vue-router-7db650a3.js";const ke={show:{type:Boolean,default:!1},imagePreventDefault:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":M(),onLongPress:M(),...U(re,["loop","indicator","onChange"]),...U(me,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{n:G,classes:$e}=he("image-preview"),L=12,Q=200,Ne=350,J=200,Xe=500,ze=ve({name:"VarImagePreview",components:{VarSwipe:le,VarSwipeItem:ce,VarPopup:pe,VarIcon:ue},inheritAttrs:!1,props:ke,setup(e){const l=v(!1),r=W(()=>{const{images:n,current:t}=e,o=n.findIndex(i=>i===t);return o>=0?o:0}),c=v(1),h=v(0),C=v(0),S=v(void 0),I=v(void 0),P=v(!0);let m=null,a=null,f=null,s=null,Y=!1;const K=W(()=>{const{imagePreventDefault:n,show:t}=e;return t&&n}),N=(n,t)=>{const{clientX:o,clientY:i}=n,{clientX:u,clientY:p}=t;return Math.abs(Math.sqrt((u-o)**2+(p-i)**2))},V=(n,t)=>({clientX:n.clientX,clientY:n.clientY,timestamp:performance.now(),target:t}),_=()=>{c.value=q(e.zoom),P.value=!1,a=null,window.setTimeout(()=>{S.value="linear",I.value="0s"},J)},b=()=>{c.value=1,h.value=0,C.value=0,P.value=!0,a=null,S.value=void 0,I.value=void 0},x=n=>a?N(a,n)<=L&&n.timestamp-a.timestamp<=Q&&a.target===n.target:!1,ee=n=>!n||!m||!a?!1:N(m,a)<=L&&performance.now()-a.timestamp<Ne&&(n===m.target||n.parentNode===m.target),ne=()=>{window.clearTimeout(s),Y=!1,m=null},oe=n=>{if(window.clearTimeout(s),Y){Y=!1;return}const t=ee(n.target);f=window.setTimeout(()=>{t&&F(),m=null},Q)},te=(n,t)=>{window.clearTimeout(f),window.clearTimeout(s);const o=V(n.touches[0],n.currentTarget);if(m=o,s=window.setTimeout(()=>{const{onLongPress:i}=e;Y=!0,D(i,t)},Xe),x(o)){c.value>1?b():_();return}a=o},E=n=>{const{offsetWidth:t,offsetHeight:o}=n,{naturalWidth:i,naturalHeight:u}=n.querySelector(`.${G("image")}`);return{width:t,height:o,imageRadio:u/i,rootRadio:o/t,zoom:q(e.zoom)}},ae=n=>{const{zoom:t,imageRadio:o,rootRadio:i,width:u,height:p}=E(n);if(!o)return 0;const y=o>i?p/o:u;return Math.max(0,(t*y-u)/2)/t},se=n=>{const{zoom:t,imageRadio:o,rootRadio:i,width:u,height:p}=E(n);if(!o)return 0;const y=o>i?p:u*o;return Math.max(0,(t*y-p)/2)/t},B=(n,t,o)=>n+t>=o?o:n+t<=-o?-o:n+t,ie=n=>{if(!a)return;const t=n.currentTarget,o=V(n.touches[0],t);if(N(o,a)>L&&window.clearTimeout(s),c.value>1){const i=o.clientX-a.clientX,u=o.clientY-a.clientY,p=ae(t),y=se(t);h.value=B(h.value,i,p),C.value=B(C.value,u,y)}a=o},F=()=>{if(c.value>1){b(),setTimeout(()=>D(e["onUpdate:show"],!1),J);return}D(e["onUpdate:show"],!1)};return de(()=>document,"contextmenu",n=>{e.imagePreventDefault&&e.show&&n.preventDefault()}),ge(()=>e.show,n=>{l.value=n},{immediate:!0}),{n:G,classes:$e,isPreventDefault:K,initialIndex:r,popupShow:l,scale:c,translateX:h,translateY:C,canSwipe:P,transitionTimingFunction:S,transitionDuration:I,handleTouchstart:te,handleTouchmove:ie,handleTouchend:oe,handleTouchcancel:ne,close:F}}});const Ae=["onTouchstart"],Le=["src","alt"];function Ve(e,l,r,c,h,C){const S=k("var-swipe-item"),I=k("var-swipe"),P=k("var-icon"),m=k("var-popup");return O(),X(m,{class:g(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:$(()=>[Te(I,Ce({class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:$(()=>[(O(!0),H(Se,null,Ie(e.images,(a,f)=>(O(),X(S,{class:g(e.n("swipe-item")),"var-image-preview-cover":"",key:a},{default:$(()=>[z("div",{class:g(e.n("zoom-container")),style:Pe({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:s=>e.handleTouchstart(s,f),onTouchmove:l[0]||(l[0]=(...s)=>e.handleTouchmove&&e.handleTouchmove(...s)),onTouchend:l[1]||(l[1]=(...s)=>e.handleTouchend&&e.handleTouchend(...s)),onTouchcancel:l[2]||(l[2]=(...s)=>e.handleTouchcancel&&e.handleTouchcancel(...s))},[z("img",{class:g(e.classes(e.n("image"),[e.isPreventDefault,e.n("--prevent")])),src:a,alt:a},null,10,Le)],46,Ae)]),_:2},1032,["class"]))),128))]),indicator:$(({index:a,length:f})=>[A(e.$slots,"indicator",{index:a,length:f},()=>[e.indicator&&e.images.length>1?(O(),H("div",{key:0,class:g(e.n("indicators"))},j(a+1)+" / "+j(f),3)):Z("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),A(e.$slots,"close-icon",{},()=>[e.closeable?(O(),X(P,{key:0,class:g(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):Z("",!0)]),z("div",{class:g(e.n("extra"))},[A(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const w=we(ze,[["render",Ve]]);let d,R={};function be(e={}){return Re(e)?{...R,images:[e]}:Ye(e)?{...R,images:e}:{...R,...e}}function T(e){if(!ye())return;T.close();const l=be(e),r=Oe(l);r.teleport="body",d=r;const{unmountInstance:c}=fe(w,r,{onClose:()=>D(r.onClose),onClosed:()=>{D(r.onClosed),c(),d===r&&(d=null)},onRouteChange:()=>{c(),d===r&&(d=null)},"onUpdate:show":h=>{r.show=h}});r.show=!0}T.close=()=>{if(d!=null){const e=d;d=null,De().then(()=>{e.show=!1})}};T.setDefaultOptions=e=>{R=e};T.resetDefaultOptions=()=>{R={}};w.install=function(e){e.component(w.name,w)};T.install=function(e){e.component(w.name,w)};T.Component=w;export{T as I};
