import{p as oe,S as ne}from"./index-78f17d7f.js";import{S as te}from"./index-d10bd310.js";import{I as ae}from"./index-14292de5.js";import{p as se,P as ie}from"./index-ea8ce718.js";import{d as re,p as E,c as le,a as R,m as ce}from"./components-a6c6deca.js";import{d as ue,a as v,b as pe,w as me,Z as F,_ as de,p as Y,f as O,i as z,S as $,q as he,m as ve,h as M,F as fe,ai as ge,N as f,M as N,R as we,O as P,Q as L,j as U,au as Te,r as Ce,n as Se,W as ye,az as Ie}from"./vue-router-2f4e575c.js";const Oe={show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":re(),...E(oe,["loop","indicator","onChange"]),...E(se,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{n:W,classes:ke}=le("image-preview"),q=12,H=200,Ye=350,Z=200,$e=ue({name:"VarImagePreview",components:{VarSwipe:ne,VarSwipeItem:te,VarPopup:ie,VarIcon:ae},inheritAttrs:!1,props:Oe,setup(e){const r=v(!1),s=pe(()=>{const{images:o,current:n}=e,t=o.findIndex(l=>l===n);return t>=0?t:0}),c=v(1),h=v(0),T=v(0),C=v(void 0),S=v(void 0),y=v(!0);let p=null,a=null,i=null;const X=(o,n)=>{const{clientX:t,clientY:l}=o,{clientX:u,clientY:m}=n;return Math.abs(Math.sqrt((u-t)**2+(m-l)**2))},D=(o,n)=>({clientX:o.clientX,clientY:o.clientY,timestamp:performance.now(),target:n}),j=()=>{c.value=F(e.zoom),y.value=!1,a=null,window.setTimeout(()=>{C.value="linear",S.value="0s"},Z)},V=()=>{c.value=1,h.value=0,T.value=0,y.value=!0,a=null,C.value=void 0,S.value=void 0},Q=o=>a?X(a,o)<=q&&o.timestamp-a.timestamp<=H&&a.target===o.target:!1,G=o=>!o||!p||!a?!1:X(p,a)<=q&&performance.now()-a.timestamp<Ye&&(o===p.target||o.parentNode===p.target),J=o=>{const n=G(o.target);i=window.setTimeout(()=>{n&&B(),p=null},H)},K=o=>{i&&window.clearTimeout(i);const n=D(o.touches[0],o.currentTarget);if(p=n,Q(n)){c.value>1?V():j();return}a=n},b=o=>{const{offsetWidth:n,offsetHeight:t}=o,{naturalWidth:l,naturalHeight:u}=o.querySelector(`.${W("image")}`);return{width:n,height:t,imageRadio:u/l,rootRadio:t/n,zoom:F(e.zoom)}},_=o=>{const{zoom:n,imageRadio:t,rootRadio:l,width:u,height:m}=b(o);if(!t)return 0;const I=t>l?m/t:u;return Math.max(0,(n*I-u)/2)/n},x=o=>{const{zoom:n,imageRadio:t,rootRadio:l,width:u,height:m}=b(o);if(!t)return 0;const I=t>l?m:u*t;return Math.max(0,(n*I-m)/2)/n},A=(o,n,t)=>o+n>=t?t:o+n<=-t?-t:o+n,ee=o=>{if(!a)return;const n=o.currentTarget,t=D(o.touches[0],n);if(c.value>1){const l=t.clientX-a.clientX,u=t.clientY-a.clientY,m=_(n),I=x(n);h.value=A(h.value,l,m),T.value=A(T.value,u,I)}a=t},B=()=>{if(c.value>1){V(),setTimeout(()=>R(e["onUpdate:show"],!1),Z);return}R(e["onUpdate:show"],!1)};return me(()=>e.show,o=>{r.value=o},{immediate:!0}),{n:W,classes:ke,initialIndex:s,popupShow:r,scale:c,translateX:h,translateY:T,canSwipe:y,transitionTimingFunction:C,transitionDuration:S,handleTouchstart:K,handleTouchmove:ee,handleTouchend:J,close:B}}});const Re=["src","alt"];function ze(e,r,s,c,h,T){const C=Y("var-swipe-item"),S=Y("var-swipe"),y=Y("var-icon"),p=Y("var-popup");return O(),z(p,{class:f(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:$(()=>[he(S,ve({class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:$(()=>[(O(!0),M(fe,null,ge(e.images,a=>(O(),z(C,{class:f(e.n("swipe-item")),"var-image-preview-cover":"",key:a},{default:$(()=>[N("div",{class:f(e.n("zoom-container")),style:we({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:r[0]||(r[0]=(...i)=>e.handleTouchstart&&e.handleTouchstart(...i)),onTouchmove:r[1]||(r[1]=(...i)=>e.handleTouchmove&&e.handleTouchmove(...i)),onTouchend:r[2]||(r[2]=(...i)=>e.handleTouchend&&e.handleTouchend(...i))},[N("img",{class:f(e.n("image")),src:a,alt:a},null,10,Re)],38)]),_:2},1032,["class"]))),128))]),indicator:$(({index:a,length:i})=>[P(e.$slots,"indicator",{index:a,length:i},()=>[e.indicator&&e.images.length>1?(O(),M("div",{key:0,class:f(e.n("indicators"))},L(a+1)+" / "+L(i),3)):U("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),P(e.$slots,"close-icon",{},()=>[e.closeable?(O(),z(y,{key:0,class:f(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):U("",!0)]),N("div",{class:f(e.n("extra"))},[P(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const g=de($e,[["render",ze]]);let d,k={};function Ne(e={}){return ye(e)?{...k,images:[e]}:Ie(e)?{...k,images:e}:{...k,...e}}function w(e){if(!Te())return;w.close();const r=Ne(e),s=Ce(r);s.teleport="body",d=s;const{unmountInstance:c}=ce(g,s,{onClose:()=>R(s.onClose),onClosed:()=>{R(s.onClosed),c(),d===s&&(d=null)},onRouteChange:()=>{c(),d===s&&(d=null)},"onUpdate:show":h=>{s.show=h}});s.show=!0}w.close=()=>{if(d!=null){const e=d;d=null,Se().then(()=>{e.show=!1})}};w.setDefaultOptions=e=>{k=e};w.resetDefaultOptions=()=>{k={}};g.install=function(e){e.component(g.name,g)};w.install=function(e){e.component(g.name,g)};w.Component=g;export{w as I};
